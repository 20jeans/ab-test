angular.module("ab.test",["ab.test.directive"]);angular.module("ab.test.directive",["ab.test.service","ngAnimate"]).factory("ab",function(abMfg){return abMfg()}).controller("abTestCtrl",["$scope","ab",function abTestCtrl($scope,ab){var ctrl=this,control=ctrl.control,variants=ctrl.variants=[],shown=$scope.shown||angular.noop,select=$scope.select||angular.noop;ctrl.add=function add(variant){variant.index=variants.length;variants.push(variant);if(variant.control){ctrl.control=control=variant}};function getResultFromSelect(){var result=null;var toSelect=$scope.select();angular.forEach(variants,function(elem){if(elem.uid===toSelect||elem.uid===parseInt(toSelect)){result=elem}});return result}$scope.run=function run(){if(ctrl.variant){ctrl.variant.active=false}var result=null;if($scope.select){result=getResultFromSelect()}if(!result){result=ab.test(variants,$scope.frequency)}if(result){result.active=true;ctrl.variant=result;shown(result)}else if(control){control.active=true;ctrl.variant=control;shown(control)}}}]).directive("abTest",["abTestLink",function abTest(abTestLink){return{restrict:"EAC",controller:"abTestCtrl",scope:{run:"=?abRun",shown:"=?abShown",frequency:"=abFrequency",select:"=?abSelect"},compile:function compile(elm,attrs){if(!angular.isDefined(attrs.abFrequency)){throw new Error("ab-test: ab-frequency attribute required")}return abTestLink}}}]).factory("abTestLink",function abTestLink(){return function link(scope,elm,attrs,ctrl){var frequency=scope.frequency;if(isNaN(frequency)||frequency<1e-4||frequency>1){throw new Error("ab-test: test frequency must be a float between 0.0001 and 1.0")}if(ctrl.variants.length===0){throw new Error("ab-test: no variants found for the a/b test")}scope.run()}}).directive("abVariant",["abVariantLink",function abVariant(abVariantLink){return{require:"^abTest",restrict:"EAC",replace:true,transclude:true,template:'<div ng-transclude ng-show="active" class="ng-class:{\'ab-active\':active}; ab-animate"></div>',scope:{uid:"=abUid",active:"=?abActive",control:"=?abControl",data:"=?abData"},controller:angular.noop,link:abVariantLink}}]).factory("abVariantLink",function abVariantLink(){return function link(scope,elm,attrs,ctrl){ctrl.add(scope)}});